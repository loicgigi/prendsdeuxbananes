/*! musicplayer - v0.1.0 - 2016-04-18 */
var socket=io();$(document).ready(function(){$("#quote-like").click(function(){socket.emit("likeQuote",$("#quote-id").text()),$("#quote-like,#quote-unlike").toggle()}),$("#quote-unlike").click(function(){socket.emit("unlikeQuote",$("#quote-id").text()),$("#quote-like,#quote-unlike").toggle()}),socket.on("updataQuoteLikesAmout",function(a){$("#quote-likes").text(a)}),$("#quote-next").click(function(){socket.emit("nextQuote",$("#quote-id").text())}),$("#quote-read-unread").click(function(){$("#quote-read-unread").toggleClass("active"),$("#content").removeClass("transparent"),$("#read").toggle(),$("#playlist").hide();var a=$("#quote-read-unread i");a.toggleClass("fa-play-circle-o"),a.toggleClass("fa-ban")}),socket.on("displayNewQuote",function(a){$("#quote-id").text(a._id),$("#quote-author").text(a.author),$("#quote-content").text(a.content),$("#quote-likes").text(a.likes),$("#quote-date").text(a.date),a.liked?($("#quote-unlike").show(),$("#quote-like").hide()):($("#quote-unlike").hide(),$("#quote-like").show())})}),$(document).ready(function(){function a(){d.getCurrentSound(function(a){$("#progresslabel").html(a.title+" - "+a.user.username),$("div[data-id-track='"+a.id+"']").parent().addClass("playing"),d.current=a,console.log("Event Handler : now playing track ",d.current.id)}),d.getDuration(function(a){d.duration=a})}var b,c,d=SC.Widget($("iframe.sc-widget")[0]),e=$(".player").offset(),f=$(".player").width(),g=12;d.bind(SC.Widget.Events.READY,function(){console.log("Event handler : player ready"),d.getSounds(function(b){c=b,a(),d.pause();var e="";$.each(c,function(a,b){e+=b.title?'<div class="col-xs-6 col-md-3"><div class="track"><div class="track-metadata" data-id-track="'+b.id+'"><span class="track-title">'+b.title+"</span><br/>"+b.user.username+"</div>":'<div class="col-xs-6 col-md-3 empty-track"><div class="track"><div class="track-metadata" data-id-track="'+b.id+'"></div>',e+='<div class="play-button"><i class="fa fa-play fa-2x" aria-hidden="true"></i></div></div></div>'}),$("#playlist").append(e)})}),d.bind(SC.Widget.Events.PLAY_PROGRESS,function(b){b.relativePosition<.003&&a(),$("#progressbar").val(b.relativePosition)}),d.bind(SC.Widget.Events.FINISH,function(){console.log("Event handler : track %s finished",d.current.id),$("div[data-id-track='"+d.current.id+"']").removeClass("playing")}),$(".player").mousemove(function(a){b=a.pageX-e.left}),$(".player").click(function(){$("#progressbar").val(b/f);var a=d.duration*(b/f);d.seekTo(a),console.log("Event handler : user seek position %s in current track",a)}),$("#track-play-pause").on("click",function(){if(c){console.log("Event handler : user click play/pause switcher");var a=$("#track-play-pause i");a.toggleClass("fa-play"),a.toggleClass("fa-pause"),d.toggle()}}),$("#init-player").on("click",function(){if(c){console.log("Event handler : user click on the big play button"),$("#play").fadeOut("slow"),$("#wrapper").addClass("grayscale-out");var a=$("#track-play-pause i");a.toggleClass("fa-play"),a.toggleClass("fa-pause"),d.play()}}),$("#track-next").on("click",function(){c&&(console.log("Event handler : user requests next track of ",d.current.id),d.isPaused(function(b){$("div[data-id-track='"+d.current.id+"']").removeClass("playing"),d.next(),b&&(d.pause(),a())}))}),$("#playlist").on("click",".play-button",function(){console.log("Event handler : user requests track in playlist");var b=$(this).parent().parent();console.log(b.index()),d.isPaused(function(c){$("div[data-id-track='"+d.current.id+"']").parent().removeClass("playing"),d.skip(b.index()),c&&(d.pause(),a())})}),$("#volumeslider").on("change",function(){var a=$(this);console.log("Event handler : user require new volume at : ",a.val()),d.setVolume(a.val())}),$("#track-playlist").on("click",function(){if(c){if(firstTrackToLoad=$(".empty-track").first(),firstTrackToLoad.length){var a=g-firstTrackToLoad.index()%g;if(a!=g){var b=firstTrackToLoad.children(".track").children(".track-metadata").data("id-track");a--;for(var d=0;a>d;d++)nextTrackToLoadId=firstTrackToLoad.nextAll().slice(d).children(".track").children(".track-metadata").data("id-track"),nextTrackToLoadId&&(b+="%2C",b+=nextTrackToLoadId);console.log("Event handler : user require next tracks list : ",b),socket.emit("nextTracks",b)}}console.log("Event handler : user toggle track-playlist button visibility"),$("#playlist").toggle(),$("#content").toggleClass("transparent"),$("#read").hide(),$("#quote-read-unread").removeClass("active")}}),$("#content").scroll(function(){if($("#content").scrollTop()+$("#content").height()==$("#content-container").height()){var a=g;if(firstTrackToLoad=$(".empty-track").first(),firstTrackToLoad.length){var b=firstTrackToLoad.children(".track").children(".track-metadata").data("id-track");a--;for(var c=0;a>c;c++)nextTrackToLoadId=firstTrackToLoad.nextAll().slice(c).children(".track").children(".track-metadata").data("id-track"),nextTrackToLoadId&&(b+="%2C",b+=nextTrackToLoadId);console.log("Event handler : user require next tracks list : ",b),socket.emit("nextTracks",b)}}}),socket.on("displayNewTracks",function(a){console.log("Event handler : server returned next tracks list",a),$.each(a,function(a,b){var c=$(".track-metadata[data-id-track='"+b.id+"']");c.html('<span class="track-title">'+b.title+"</span><br/>"+b.artist),c.parent().parent().removeClass("empty-track")})})});